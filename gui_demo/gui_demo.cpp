#include <cradle/gui/widgets.hpp>
#include <cradle/gui/app/instance.hpp>
#include <cradle/gui/app/interface.hpp>

#include <gui_demo/registry.hpp>

using namespace gui_demo;

struct root_task_group_controller : task_group_controller
{
    string get_root_task_type_id() { return "demo_task"; }

    virtual cradle::app_context&
    get_internal_app_context(gui_context& ctx, cradle::app_context& app_ctx)
    {
        return app_ctx;
    }

    indirect_accessor<gui_task_group_state>
    get_state_accessor(gui_context& ctx, cradle::app_context& app_ctx)
    {
        // Use local state for this task group.
        state_accessor<gui_task_group_state> state;
        if (get_state(ctx, &state))
        {
            set(state,
                make_initial_task_group_state(*app_ctx.instance,
                    this->get_root_task_type_id()));
        }
        return make_indirect(ctx, state);
    }

    void do_header_label(gui_context& ctx, cradle::app_context& app_ctx)
    {
        row_layout row(ctx, BASELINE_Y);
        do_app_logo(ctx, _field(get_app_info(ctx, app_ctx), logo), BASELINE_Y);
        do_styled_text(ctx, text("title"), text("GUI Demo"), UNPADDED);
    }
};

struct app_controller : app_controller_interface
{
    app_info get_app_info()
    {
        // Leaving the app version empty results in the app version
        // installed to the realm being used.
        return app_info(
            "decimal",
            "planning",
            "",
            "open-cradle GUI Demo",
            "1.0.0",
            "",
            "",
            // SVG app_info.logo for this app
            "<svg width=\"97mm\" height=\"17mm\" version=\"1.1\" viewBox=\"0 0 97 17\" xmlns=\"http://www.w3.org/2000/svg\"><g transform=\"translate(0,-280)\"><g transform=\"matrix(.2646 0 0 .2646 -14.17 233.6)\" fill=\"#fff\" aria-label=\"app_info.logo\"><path d=\"m103.7 216.1v-4.57q-1.426 0.1172-3.086 0.332-1.66 0.1953-2.52 0.4688-1.055 0.332-1.621 0.9766-0.5469 0.625-0.5469 1.66 0 0.6836 0.1172 1.113 0.1172 0.4297 0.5859 0.8203 0.4492 0.3906 1.074 0.5859 0.625 0.1758 1.953 0.1758 1.055 0 2.129-0.4297 1.094-0.4297 1.914-1.133zm0 3.398q-0.5664 0.4297-1.406 1.035t-1.582 0.957q-1.035 0.4688-2.148 0.6836-1.113 0.2344-2.441 0.2344-3.125 0-5.234-1.934t-2.109-4.941q0-2.402 1.074-3.926 1.074-1.523 3.047-2.402 1.953-0.8789 4.844-1.25 2.891-0.3711 5.996-0.5469v-0.1172q0-1.816-1.484-2.5-1.484-0.7031-4.375-0.7031-1.738 0-3.711 0.625-1.973 0.6055-2.832 0.9375h-0.6445v-5.293q1.113-0.293 3.613-0.6836 2.52-0.4102 5.039-0.4102 5.996 0 8.652 1.855 2.676 1.836 2.676 5.781v14.92h-6.973z\"/><path d=\"m140.1 210.6q0 2.715-0.8398 4.941-0.8203 2.227-2.168 3.672-1.406 1.523-3.184 2.305t-3.809 0.7812q-1.875 0-3.184-0.4102-1.309-0.3906-2.676-1.113v9.141h-7.031v-29.98h7.031v2.285q1.621-1.289 3.301-2.09 1.699-0.8008 3.906-0.8008 4.102 0 6.367 3.008 2.285 3.008 2.285 8.262zm-7.246 0.1367q0-3.203-1.094-4.648-1.094-1.445-3.457-1.445-0.9961 0-2.051 0.3125-1.055 0.293-2.012 0.8594v11.04q0.7031 0.2734 1.504 0.3516 0.8008 0.0781 1.582 0.0781 2.793 0 4.16-1.621 1.367-1.641 1.367-4.922z\"/><path d=\"m168 210.6q0 2.715-0.8398 4.941-0.8203 2.227-2.168 3.672-1.406 1.523-3.184 2.305t-3.809 0.7812q-1.875 0-3.184-0.4102-1.309-0.3906-2.676-1.113v9.141h-7.031v-29.98h7.031v2.285q1.621-1.289 3.301-2.09 1.699-0.8008 3.906-0.8008 4.102 0 6.367 3.008 2.285 3.008 2.285 8.262zm-7.246 0.1367q0-3.203-1.094-4.648-1.094-1.445-3.457-1.445-0.9961 0-2.051 0.3125-1.055 0.293-2.012 0.8594v11.04q0.7031 0.2734 1.504 0.3516 0.8008 0.0781 1.582 0.0781 2.793 0 4.16-1.621 1.367-1.641 1.367-4.922z\"/><path d=\"m198.5 228.7h-29.06v-4.121h29.06z\"/><path d=\"m208.6 221.9h-7.031v-21.93h7.031zm0.1953-25.06h-7.422v-5.332h7.422z\"/><path d=\"m237.3 221.9h-7.07v-10.88q0-1.328-0.1367-2.637-0.1367-1.328-0.4688-1.953-0.3906-0.7227-1.152-1.055-0.7422-0.332-2.09-0.332-0.957 0-1.953 0.3125-0.9766 0.3125-2.129 0.9961v15.55h-7.031v-21.93h7.031v2.422q1.875-1.465 3.594-2.246 1.738-0.7812 3.848-0.7812 3.555 0 5.547 2.07 2.012 2.07 2.012 6.191z\"/><path d=\"m258 196.6h-0.5273q-0.4688-0.1367-1.23-0.3125-0.7422-0.1758-1.602-0.1758-2.07 0-2.812 0.7422-0.7227 0.7422-0.7227 2.871v0.1758h5.43v4.766h-5.195v17.17h-7.031v-17.17h-3.008v-4.766h3.008v-0.6055q0-4.023 2.129-6.035 2.148-2.012 6.484-2.012 1.562 0 2.832 0.1172 1.27 0.0976 2.246 0.2734z\"/><path d=\"m283 210.9q0 5.41-3.164 8.535-3.145 3.105-8.848 3.105-5.703 0-8.867-3.105-3.145-3.125-3.145-8.535 0-5.449 3.164-8.555 3.184-3.105 8.848-3.105 5.742 0 8.867 3.125 3.145 3.125 3.145 8.535zm-8.652 5.332q0.6836-0.8398 1.016-2.012 0.3516-1.191 0.3516-3.281 0-1.934-0.3516-3.242-0.3516-1.309-0.9766-2.09-0.625-0.8008-1.504-1.133-0.8789-0.332-1.895-0.332-1.016 0-1.816 0.2734-0.7812 0.2734-1.504 1.094-0.6445 0.7617-1.035 2.09-0.3711 1.328-0.3711 3.34 0 1.797 0.332 3.125 0.332 1.309 0.9766 2.109 0.625 0.7617 1.484 1.113 0.8789 0.3516 1.992 0.3516 0.957 0 1.816-0.3125 0.8789-0.332 1.484-1.094z\"/><path d=\"m295.7 221.9h-7.305v-7.676h7.305z\"/><path d=\"m309.6 221.9h-7.031v-30.39h7.031z\"/><path d=\"m338.7 210.9q0 5.41-3.164 8.535-3.145 3.105-8.848 3.105-5.703 0-8.867-3.105-3.145-3.125-3.145-8.535 0-5.449 3.164-8.555 3.184-3.105 8.848-3.105 5.742 0 8.867 3.125 3.145 3.125 3.145 8.535zm-8.652 5.332q0.6836-0.8398 1.016-2.012 0.3516-1.191 0.3516-3.281 0-1.934-0.3516-3.242-0.3516-1.309-0.9766-2.09-0.625-0.8008-1.504-1.133-0.8789-0.332-1.895-0.332-1.016 0-1.816 0.2734-0.7812 0.2734-1.504 1.094-0.6445 0.7617-1.035 2.09-0.3711 1.328-0.3711 3.34 0 1.797 0.332 3.125 0.332 1.309 0.9766 2.109 0.625 0.7617 1.484 1.113 0.8789 0.3516 1.992 0.3516 0.957 0 1.816-0.3125 0.8789-0.332 1.484-1.094z\"/><path d=\"m365.1 219.4q0 3.086-0.8789 5.195-0.8789 2.109-2.461 3.301-1.582 1.211-3.828 1.738-2.227 0.5469-5.039 0.5469-2.285 0-4.512-0.2734-2.207-0.2734-3.828-0.6641v-5.488h0.8594q1.289 0.5078 3.145 0.918 1.855 0.4297 3.32 0.4297 1.953 0 3.164-0.3711 1.23-0.3516 1.875-1.016 0.6055-0.625 0.8789-1.602t0.2734-2.344v-0.4102q-1.27 1.035-2.812 1.641-1.543 0.6055-3.438 0.6055-4.609 0-7.109-2.773t-2.5-8.438q0-2.715 0.7617-4.688 0.7617-1.973 2.148-3.438 1.289-1.367 3.164-2.129 1.895-0.7617 3.867-0.7617 1.777 0 3.223 0.4297 1.465 0.4102 2.656 1.152l0.2539-0.9766h6.816zm-7.031-4.395v-9.941q-0.6055-0.2539-1.484-0.3906-0.8789-0.1562-1.582-0.1562-2.773 0-4.16 1.602-1.387 1.582-1.387 4.434 0 3.164 1.172 4.414 1.191 1.25 3.516 1.25 1.055 0 2.07-0.332 1.016-0.332 1.855-0.8789z\"/><path d=\"m394.1 210.9q0 5.41-3.164 8.535-3.145 3.105-8.848 3.105-5.703 0-8.867-3.105-3.145-3.125-3.145-8.535 0-5.449 3.164-8.555 3.184-3.105 8.848-3.105 5.742 0 8.867 3.125 3.145 3.125 3.145 8.535zm-8.652 5.332q0.6836-0.8398 1.016-2.012 0.3516-1.191 0.3516-3.281 0-1.934-0.3516-3.242-0.3516-1.309-0.9766-2.09-0.625-0.8008-1.504-1.133-0.8789-0.332-1.895-0.332-1.016 0-1.816 0.2734-0.7812 0.2734-1.504 1.094-0.6445 0.7617-1.035 2.09-0.3711 1.328-0.3711 3.34 0 1.797 0.332 3.125 0.332 1.309 0.9766 2.109 0.625 0.7617 1.484 1.113 0.8789 0.3516 1.992 0.3516 0.957 0 1.816-0.3125 0.8789-0.332 1.484-1.094z\"/></g></g></svg>");
    }

    void register_tasks() { gui_demo::register_tasks(); }

    task_group_controller* get_root_task_group_controller()
    { return new root_task_group_controller; }

    std::map<char*, char*> get_app_command_line_arguments()
    {
        std::map<char*, char*> arguments;
        return arguments;
    }

    void process_app_command_line_arguments(
        boost::program_options::variables_map const& vm)
    {
    }
};

CRADLE_IMPLEMENT_APP(app_controller)
